<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Suite LSS v2.0 - Imprenta</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0f172a; 
            --accent: #3b82f6;  
            --success: #10b981; 
            --warning: #f59e0b; 
            --danger: #ef4444;  
            --muda: #713f12; /* Color caf√© para desperdicio */
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #334155;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- Header --- */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { margin: 0; font-size: 1.5rem; }
        .subtitle { font-size: 0.9rem; opacity: 0.8; }

        /* --- Navigation --- */
        nav {
            background-color: white;
            padding: 0 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 2rem;
            flex-shrink: 0;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 0;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn:hover { color: var(--primary); }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

        /* --- Main Content --- */
        main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Cards & Grid --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
        }

        .card h3 { margin-top: 0; color: var(--primary); border-bottom: 2px solid #f1f5f9; padding-bottom: 0.5rem; display: flex; align-items: center; gap: 10px; }
        
        /* Info Box for Education */
        .info-box {
            background-color: #f0f9ff;
            border-left: 4px solid var(--accent);
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .info-box h4 { margin: 0 0 0.5rem 0; color: var(--accent); }

        /* --- Belts Visuals --- */
        .belt-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 999px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.5rem; color: #1e293b; border: 1px solid #cbd5e1; }
        .belt-white { background: #ffffff; }
        .belt-yellow { background: #fef08a; }
        .belt-green { background: #86efac; }
        .belt-black { background: #1e293b; color: white; }
        .belt-master { background: linear-gradient(45deg, #1e293b, #ef4444); color: white; }

        /* --- Simulation Forms --- */
        .form-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 0.4rem; color: #475569; }
        input[type="number"] { width: 100%; padding: 0.6rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; box-sizing: border-box; }
        
        .kpi-value { font-size: 2.5rem; font-weight: 800; color: var(--accent); }
        .kpi-label { font-size: 0.9rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }

        /* --- Canvas Containers --- */
        .canvas-container { position: relative; height: 300px; width: 100%; }

        /* --- Tables --- */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background-color: #f8fafc; font-weight: 600; }

    </style>
</head>
<body>

<header>
    <div>
        <h1>Master Suite: Lean Six Sigma v2.0</h1>
        <div class="subtitle">Simulador Ejecutivo & Gu√≠a Educativa (Imprenta)</div>
    </div>
    <div style="text-align: right;">
        <span style="font-size: 0.8rem; opacity: 0.7;">Usuario: Executive Master Belt</span><br>
        <strong>Imprenta 10: Online</strong>
    </div>
</header>

<nav>
    <button class="tab-btn active" onclick="switchTab('dashboard')">1. Estrategia & Belts</button>
    <button class="tab-btn" onclick="switchTab('lean')">2. Lean: OEE & Mudas</button>
    <button class="tab-btn" onclick="switchTab('sixsigma')">3. Six Sigma: CPK & Calidad</button>
    <button class="tab-btn" onclick="switchTab('audit')">4. Algoritmo Auditor√≠a</button>
</nav>

<main>

    <div id="dashboard" class="section active">
        <div class="card">
            <h3>üó∫Ô∏è Estructura Organizacional: Imprenta</h3>
            <p>La jerarqu√≠a de conocimiento necesaria para operar y mejorar la planta de corrugado y conversi√≥n.</p>
        </div>
        <div class="grid-4">
            <div class="card">
                <span class="belt-badge belt-white">White / Yellow Belt</span>
                <h4>El Operador / Ayudante</h4>
                <p style="font-size: 0.9rem;"><strong>Rol:</strong> Detectar anomal√≠as y sostener.</p>
                <hr>
                <ul style="font-size: 0.85rem; padding-left: 1.2rem;">
                    <li>Entiende 5S (Limpieza).</li>
                    <li>Llena hojas de control.</li>
                    <li>Sabe diferenciar "Interno" vs "Externo".</li>
                </ul>
            </div>
            <div class="card">
                <span class="belt-badge belt-green">Green Belt</span>
                <h4>Supervisor de Producci√≥n</h4>
                <p style="font-size: 0.9rem;"><strong>Rol:</strong> Liderar mejora local.</p>
                <hr>
                <ul style="font-size: 0.85rem; padding-left: 1.2rem;">
                    <li>Maneja equipos de trabajo.</li>
                    <li>Ejecuta eventos Kaizen (SMED).</li>
                    <li>Estad√≠stica b√°sica (Pareto).</li>
                </ul>
            </div>
            <div class="card">
                <span class="belt-badge belt-black">Black Belt</span>
                <h4>Gerente / Ing. Senior</h4>
                <p style="font-size: 0.9rem;"><strong>Rol:</strong> Proyectos complejos.</p>
                <hr>
                <ul style="font-size: 0.85rem; padding-left: 1.2rem;">
                    <li>Optimiza flujo Corrugadora -> Imprenta.</li>
                    <li>Dise√±o de Experimentos (DOE).</li>
                    <li>Minitab y An√°lisis de Varianza.</li>
                </ul>
            </div>
            <div class="card">
                <span class="belt-badge belt-master">Master Black Belt</span>
                <h4>Executive Suite (T√ö)</h4>
                <p style="font-size: 0.9rem;"><strong>Rol:</strong> Estrategia y ROI.</p>
                <hr>
                <ul style="font-size: 0.85rem; padding-left: 1.2rem;">
                    <li>Define qu√© proyectos importan ($).</li>
                    <li>Entrena a los Belts.</li>
                    <li>Audita el sistema (Excel de Robin).</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="lean" class="section">
        <div class="grid-2">
            <div>
                <div class="card">
                    <h3>‚öôÔ∏è Tiempos Base Imprenta</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Tiempo Turno (min)</label>
                            <input type="number" id="lean_time" value="480" oninput="calcLean()">
                        </div>
                        <div class="form-group">
                            <label>Paradas Planif. (Comida) (min)</label>
                            <input type="number" id="lean_break" value="30" oninput="calcLean()">
                        </div>
                    </div>
                </div>

                <div class="card" style="border-left: 5px solid var(--warning);">
                    <h3>‚è±Ô∏è SMED: Tiempos de Cambio</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Cambios (Setups) por Turno</label>
                            <input type="number" id="lean_setups" value="5" oninput="calcLean()">
                        </div>
                        <div class="form-group">
                            <label>Minutos por Cambio (Promedio)</label>
                            <input type="number" id="lean_setup_time" value="45" oninput="calcLean()">
                        </div>
                    </div>
                </div>

                <div class="card" style="border-left: 5px solid var(--muda);">
                    <h3>üóëÔ∏è Las Mudas (P√©rdidas Adicionales)</h3>
                    <p style="font-size: 0.8rem; margin-bottom: 10px;">Ingresa aqu√≠ los tiempos muertos NO planificados.</p>
                    <div class="form-group">
                        <label>Esperas (Falta de Cart√≥n/Tinta) (min)</label>
                        <input type="number" id="muda_wait" value="20" oninput="calcLean()">
                    </div>
                    <div class="form-group">
                        <label>Fallas de M√°quina (Mtto) (min)</label>
                        <input type="number" id="muda_breakdown" value="15" oninput="calcLean()">
                    </div>
                    <div class="form-group">
                        <label>Otros Micro-paros (min)</label>
                        <input type="number" id="muda_others" value="10" oninput="calcLean()">
                    </div>
                </div>

                <div class="card">
                    <h3>üöÄ Velocidad</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Vel. Dise√±o (Cajas/hr)</label>
                            <input type="number" id="lean_speed_design" value="12000" oninput="calcLean()">
                        </div>
                        <div class="form-group">
                            <label>Vel. Real (Cajas/hr)</label>
                            <input type="number" id="lean_speed_real" value="7500" oninput="calcLean()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìä Diagn√≥stico OEE en Tiempo Real</h3>
                <div class="grid-3" style="text-align: center; margin-bottom: 1rem;">
                    <div>
                        <div class="kpi-value" id="res_avail">0%</div>
                        <div class="kpi-label">Disponibilidad</div>
                    </div>
                    <div>
                        <div class="kpi-value" id="res_perf">0%</div>
                        <div class="kpi-label">Rendimiento</div>
                    </div>
                    <div>
                        <div class="kpi-value" id="res_oee" style="color: var(--primary);">0%</div>
                        <div class="kpi-label">OEE GLOBAL</div>
                    </div>
                </div>
                
                <div class="canvas-container">
                    <canvas id="oeeChart"></canvas>
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: #fff7ed; border: 1px solid #fed7aa; border-radius: 8px; color: #9a3412;">
                    <strong>üîç An√°lisis de P√©rdidas:</strong><br>
                    <span id="loss_analysis">Calculando...</span>
                </div>
            </div>
        </div>
    </div>

    <div id="sixsigma" class="section">
        
        <div class="card" style="background: #f8fafc; border: 1px dashed #cbd5e1;">
            <h3>üìñ Gu√≠a Maestra: ¬øDe d√≥nde salen los datos?</h3>
            <div class="grid-2">
                <div>
                    <h4 style="color: var(--primary);">1. L√≠mites de Especificaci√≥n (USL / LSL)</h4>
                    <p style="font-size: 0.9rem;"><strong>"La Voz del Cliente"</strong>. Son inamovibles (a menos que renegocies).</p>
                    <ul style="font-size: 0.85rem;">
                        <li><strong>Origen:</strong> Hoja de Especificaci√≥n del Cliente, Orden de Compra (PO) o Ficha T√©cnica SAP.</li>
                        <li><strong>Ejemplo:</strong> El cliente pide una caja con altura de 30cm +/- 1mm.
                            <br>USL (L√≠mite Superior) = 30.1 cm
                            <br>LSL (L√≠mite Inferior) = 29.9 cm
                        </li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: var(--accent);">2. Promedio y Desviaci√≥n (Mean / Sigma)</h4>
                    <p style="font-size: 0.9rem;"><strong>"La Voz del Proceso"</strong>. Es la realidad de la Imprenta.</p>
                    <ul style="font-size: 0.85rem;">
                        <li><strong>Origen:</strong> Debes ir a la m√°quina, tomar 30-50 cajas seguidas y medirlas con un calibrador/flex√≥metro.</li>
                        <li><strong>C√°lculo:</strong> Ingresas esas 50 mediciones en Excel y calculas el Promedio ($\mu$) y la Desviaci√≥n Est√°ndar ($\sigma$).</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <h3>üéØ Calculadora CPK</h3>
                
                <div class="form-group">
                    <label>Especificaci√≥n del Cliente (Meta)</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="ss_lsl" value="2.8" placeholder="LSL (min)">
                        <input type="number" id="ss_usl" value="3.2" placeholder="USL (max)">
                    </div>
                </div>

                <div class="form-group">
                    <label>Datos Reales Imprenta (Medidos)</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="ss_mean" value="3.0" step="0.01" placeholder="Promedio Real">
                        <input type="number" id="ss_std" value="0.05" step="0.001" placeholder="Desv. Std Real">
                    </div>
                </div>

                <button onclick="drawBellCurve()" style="width: 100%; padding: 1rem; background: var(--accent); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
                    ‚ö° Calcular CPK y Simular
                </button>

                <div class="info-box">
                    <h4>üßÆ ¬øC√≥mo se calcula el Cpk?</h4>
                    <p>El Cpk pregunta dos cosas:</p>
                    <ol style="margin: 0; padding-left: 1.2rem;">
                        <li>¬øQu√© tan cerca est√° tu promedio del l√≠mite superior? ($Cpu$)</li>
                        <li>¬øQu√© tan cerca est√° tu promedio del l√≠mite inferior? ($Cpl$)</li>
                    </ol>
                    <p><strong>F√≥rmula:</strong> Se toma el PEOR de los dos casos (el valor m√≠nimo).</p>
                    <code style="background: #e2e8f0; padding: 2px 5px; border-radius: 4px;">Cpk = min[ (USL-Promedio)/3œÉ , (Promedio-LSL)/3œÉ ]</code>
                </div>

                <div style="margin-top: 1rem;">
                    <table id="ss_results">
                        <tr>
                            <td><strong>Resultado Cpk:</strong></td>
                            <td style="font-weight: bold; font-size: 1.4rem;" id="res_cpk">-</td>
                        </tr>
                        <tr>
                            <td>Nivel Sigma:</td>
                            <td id="res_sigma">-</td>
                        </tr>
                        <tr>
                            <td>Defectos (PPM):</td>
                            <td id="res_ppm" style="color: var(--danger); font-weight: bold;">-</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>üìà Curva de Distribuci√≥n Normal</h3>
                <canvas id="bellCurveCanvas" width="500" height="300" style="width: 100%; height: 300px; border: 1px solid #f1f5f9; background: #fff;"></canvas>
                <div style="font-size: 0.8rem; color: #64748b; margin-top: 10px; text-align: center;">
                    √Årea Roja = Defectos (Basura) | √Årea Verde = Cajas Vendibles<br>
                    <strong>Objetivo:</strong> Que la campana verde sea delgada y est√© centrada entre las l√≠neas rojas punteadas.
                </div>
            </div>
        </div>
    </div>

    <div id="audit" class="section">
        <div class="card">
            <h3>ü§ñ Algoritmo de Auditor√≠a del Master Black Belt</h3>
            <p>Sigue estos pasos l√≥gicos al analizar el Excel de Robin o cualquier reporte de planta.</p>
            
            <div style="background: white; padding: 1.5rem; border-left: 4px solid var(--accent); margin-bottom: 1rem;">
                <h4>PASO 1: Sanidad de Datos (Inputs)</h4>
                <p>Antes de calcular nada, verifica en el Excel:</p>
                <ul>
                    <li>¬øEst√°n separados los "Cambios" de las "Fallas"? (Si todo est√° mezclado en "Paradas", no puedes hacer Lean).</li>
                    <li>¬øEl tiempo de comida se descuenta del tiempo disponible?</li>
                </ul>
            </div>

            <div style="background: white; padding: 1.5rem; border-left: 4px solid var(--warning); margin-bottom: 1rem;">
                <h4>PASO 2: Estabilizar (Lean / OEE)</h4>
                <p>Mira el OEE que calculamos en la Pesta√±a 2.</p>
                <ul>
                    <li>Si <strong>Mudas > 30 min/turno:</strong> Aplica 5S y gesti√≥n de materiales.</li>
                    <li>Si <strong>Setup > 15 min:</strong> Aplica SMED.</li>
                    <li>Si <strong>Velocidad Real es baja:</strong> Revisa el estado mec√°nico (Rodillos, Bandas).</li>
                </ul>
            </div>

            <div style="background: white; padding: 1.5rem; border-left: 4px solid var(--success);">
                <h4>PASO 3: Capacidad (Six Sigma / Cpk)</h4>
                <p>Solo avanza aqu√≠ si el Paso 2 est√° estable.</p>
                <ul>
                    <li>Si <strong>Cpk < 1.0:</strong> ¬°Peligro! Est√°s enviando cajas malas al cliente. Det√©n y ajusta.</li>
                    <li>Si <strong>Cpk > 1.33:</strong> Proceso sano. Reduce frecuencia de inspecci√≥n.</li>
                </ul>
            </div>
        </div>
    </div>

</main>

<script>
    // --- NAVEGACI√ìN ---
    function switchTab(tabId) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');

        if(tabId === 'sixsigma') drawBellCurve();
    }

    // --- CHART.JS INSTANCE ---
    let oeeChartInstance = null;

    // --- L√ìGICA LEAN (SMED/OEE/MUDAS) ---
    function calcLean() {
        // 1. Tiempos Base
        const totalTime = parseFloat(document.getElementById('lean_time').value) || 0;
        const breakTime = parseFloat(document.getElementById('lean_break').value) || 0;
        
        // 2. SMED (Cambios)
        const setups = parseFloat(document.getElementById('lean_setups').value) || 0;
        const setupTime = parseFloat(document.getElementById('lean_setup_time').value) || 0;
        const totalSetupLoss = setups * setupTime;

        // 3. Mudas (Desperdicios) - NUEVO
        const waitTime = parseFloat(document.getElementById('muda_wait').value) || 0;
        const breakdownTime = parseFloat(document.getElementById('muda_breakdown').value) || 0;
        const otherTime = parseFloat(document.getElementById('muda_others').value) || 0;
        const totalMudas = waitTime + breakdownTime + otherTime;

        // 4. Velocidad
        const speedDesign = parseFloat(document.getElementById('lean_speed_design').value) || 1;
        const speedReal = parseFloat(document.getElementById('lean_speed_real').value) || 0;

        // --- C√ÅLCULOS ---
        const plannedTime = totalTime - breakTime; // Tiempo que la planta est√° abierta para trabajar
        
        // Tiempo Operativo Real (restando cambios y mudas)
        const operatingTime = plannedTime - totalSetupLoss - totalMudas;
        
        // Disponibilidad
        let availability = (operatingTime / plannedTime) * 100;
        if(availability < 0) availability = 0;

        // Rendimiento
        let performance = (speedReal / speedDesign) * 100;

        // Calidad (Asumida fija para simplicidad en esta pesta√±a)
        const quality = 98; 

        // OEE
        const oee = (availability/100) * (performance/100) * (quality/100) * 100;

        // --- ACTUALIZAR DOM ---
        document.getElementById('res_avail').innerText = availability.toFixed(1) + "%";
        document.getElementById('res_perf').innerText = performance.toFixed(1) + "%";
        document.getElementById('res_oee').innerText = oee.toFixed(1) + "%";

        // An√°lisis de P√©rdidas Texto
        document.getElementById('loss_analysis').innerHTML = `
            De tus <strong>${plannedTime} minutos</strong> disponibles:<br>
            - Perdiste <strong>${totalSetupLoss} min</strong> en Cambios.<br>
            - Perdiste <strong>${totalMudas} min</strong> en Mudas (Fallas/Esperas).<br>
            Solo produjiste efectivamente durante <strong>${operatingTime} min</strong>.
        `;

        updateOEEChart(availability, performance, quality);
    }

    function updateOEEChart(a, p, q) {
        const ctx = document.getElementById('oeeChart').getContext('2d');
        
        if (oeeChartInstance) {
            oeeChartInstance.destroy();
        }

        oeeChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Disponibilidad', 'Rendimiento', 'Calidad'],
                datasets: [{
                    label: 'Factores OEE %',
                    data: [a, p, q],
                    backgroundColor: [
                        a < 60 ? '#ef4444' : (a < 80 ? '#f59e0b' : '#10b981'),
                        p < 70 ? '#f59e0b' : '#3b82f6',
                        '#10b981'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, max: 100 }
                }
            }
        });
    }

    // --- L√ìGICA SIX SIGMA (CPK) ---
    function drawBellCurve() {
        const canvas = document.getElementById('bellCurveCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // Inputs
        const lsl = parseFloat(document.getElementById('ss_lsl').value);
        const usl = parseFloat(document.getElementById('ss_usl').value);
        const mean = parseFloat(document.getElementById('ss_mean').value);
        const std = parseFloat(document.getElementById('ss_std').value);

        // Calc CPK
        const cpu = (usl - mean) / (3 * std);
        const cpl = (mean - lsl) / (3 * std);
        const cpk = Math.min(cpu, cpl);
        
        // Update Results Text
        const resEl = document.getElementById('res_cpk');
        resEl.innerText = cpk.toFixed(2);
        
        if(cpk < 1.0) resEl.style.color = '#ef4444'; // Red
        else if(cpk < 1.33) resEl.style.color = '#f59e0b'; // Yellow
        else resEl.style.color = '#10b981'; // Green

        document.getElementById('res_sigma').innerText = (cpk * 3).toFixed(1) + " œÉ";
        
        // PPM Estimate logic
        let ppm = 0;
        if (cpk < 0.5) ppm = "> 60,000 (Cr√≠tico)";
        else if (cpk < 1.0) ppm = "~ 2,700 a 60,000";
        else if (cpk < 1.33) ppm = "~ 63 a 2,700";
        else ppm = "< 63 (Clase Mundial)";
        document.getElementById('res_ppm').innerText = ppm;

        // --- DRAWING THE CURVE ---
        ctx.clearRect(0, 0, width, height);
        
        const viewMin = Math.min(lsl, mean - 4*std) - 0.2;
        const viewMax = Math.max(usl, mean + 4*std) + 0.2;
        const range = viewMax - viewMin;
        
        function mapX(val) { return ((val - viewMin) / range) * width; }
        function getY(x) { return (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2)); }
        
        const maxY = getY(mean);
        const paddingBottom = 30;
        function mapY(yVal) { return height - paddingBottom - (yVal / maxY) * (height - 60); }

        // Draw Bell Curve
        ctx.beginPath();
        ctx.lineWidth = 3;
        ctx.strokeStyle = "#3b82f6";
        let started = false;
        for(let pixelX = 0; pixelX <= width; pixelX+=2) {
            const val = viewMin + (pixelX / width) * range;
            const yVal = getY(val);
            const pixelY = mapY(yVal);
            if(!started) { ctx.moveTo(pixelX, pixelY); started = true; }
            else { ctx.lineTo(pixelX, pixelY); }
        }
        ctx.stroke();

        // Draw Limits
        function drawLine(val, color, text) {
            const x = mapX(val);
            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, height); 
            ctx.strokeStyle = color; ctx.lineWidth=2; ctx.setLineDash([5, 5]); ctx.stroke();
            ctx.fillStyle = color; ctx.font = "bold 12px Arial"; ctx.fillText(text, x + 5, 20);
            ctx.setLineDash([]);
        }

        drawLine(lsl, "#ef4444", "LSL");
        drawLine(usl, "#ef4444", "USL");
        
        // Mean Line
        const xMean = mapX(mean);
        ctx.beginPath(); ctx.moveTo(xMean, mapY(getY(mean))); ctx.lineTo(xMean, height); 
        ctx.strokeStyle = "#10b981"; ctx.setLineDash([]); ctx.stroke();
        ctx.fillStyle = "#10b981"; ctx.fillText("Promedio", xMean + 5, mapY(getY(mean)) - 5);
    }

    // Initial load
    calcLean();
</script>

</body>
</html>
